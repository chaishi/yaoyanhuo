<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><link rel="icon" href="/favicon.jpg"><title>yaoyanhuo</title><link href="/css/router.f5a5336d.css" rel="prefetch"><link href="/js/router.7db9e200.js" rel="prefetch"><link href="/css/app.3ec86574.css" rel="preload" as="style"><link href="/js/app.1b00deba.js" rel="preload" as="script"><link href="/js/chunk-vendors.feddb447.js" rel="preload" as="script"><link href="/css/app.3ec86574.css" rel="stylesheet"><link rel="stylesheet" type="text/css" href="/css/router.f5a5336d.css"><script charset="utf-8" src="/js/router.7db9e200.js"></script></head><body><noscript><strong>We're sorry but yaoyanhuo doesn't work properly without JavaScript enabled. Please enable it to continue.</strong></noscript><div id="app"><div class="head"><div class="head-inner g_page-container"><a href="/" class="router-link-active"><img src="/img/head.jpg"></a><div class="info"><h1 class="name">Yaoyanhuo 妖艳货</h1><span>Be a simple programmer. </span></div></div></div><div><div class="blog-detail g_page-container"><div class="markdown-body"><div class="markdown-to-vue-loader"><h1 id="vue-项目中使用-jsx-出现的语法冲突，导致-props-传入失效">Vue 项目中使用 JSX 出现的语法冲突，导致 props 传入失效</h1><p><em>posted by yaoyanhuo on 2019-03-22</em></p><blockquote><p>有这样一个场景，switch 组件需要两个 props 参数：onText 和 offText，用于表述开关状态。在 JSX 使用 switch 组件时，在控制台发现 offText 传入 props 很正常，但 onText 却怎么也没有数据，无论传值是什么。这是为何呢？一起来看看吧。</p></blockquote><p>从 2016 年写 Vue 到现在，总觉得该遇到的问题都差不多了，结果这就来了个意料之外的问题，如上引文描述。</p><h2 id="vue-和-jsx-的关系">Vue 和 JSX 的关系</h2><p>官网地址描述: <a href="https://cn.vuejs.org/v2/guide/render-function.html">https://cn.vuejs.org/v2/guide/render-function.html</a> 。内容比较多，此处简述一下，Vue 有两种书写 html 的方式，一种是在 <code>.vue</code> 文件中使用 <code>template</code>，很方便，跟写直接写 html 一样，该方式也是官方建议的方式；另一种是在 <code>.js</code> 文件中使用 <code>render</code> 函数书写，该方式书写比较复杂，可读性也不好，但有时候确实需要使用这种方式 那怎么办呢？<code>JSX</code> 就出来了。可以说，<code>JSX</code> 是 <code>createElement</code> 方法的一种语法糖。</p><h2 id="问题复现-demo">问题复现 Demo</h2><p>父组件：test.js</p><pre><code><span class="token keyword">import</span> DSwitch <span class="token keyword">from</span> <span class="token string">'./switch.js'</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  name<span class="token punctuation">:</span> <span class="token string">'Test'</span><span class="token punctuation">,</span>
  components<span class="token punctuation">:</span> <span class="token punctuation">{</span> DSwitch <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">render</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>d<span class="token operator">-</span><span class="token keyword">switch</span> offText<span class="token operator">=</span><span class="token string">"已关闭"</span> onText<span class="token operator">=</span><span class="token string">"已打开"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>d<span class="token operator">-</span><span class="token keyword">switch</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><p>子组件：switch.js</p><pre><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  name<span class="token punctuation">:</span> <span class="token string">'DSwitch'</span><span class="token punctuation">,</span>

  props<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    onText<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      <span class="token keyword">default</span><span class="token punctuation">:</span> <span class="token string">'open'</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    offText<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      <span class="token keyword">default</span><span class="token punctuation">:</span> <span class="token string">'closed'</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>

  <span class="token function">render</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>p<span class="token operator">&gt;</span>onText<span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>onText<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>p<span class="token operator">&gt;</span>offText<span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>offText<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><p>运行结果如图，</p><p><img src="http://img.yaoyanhuo.com/jsx_on_syntax.png" alt="运行结果"></p><p>是不是很奇怪，传入的 <code>offText</code> 正常显示了， 而 <code>onText</code> 却没有。</p><h2 id="问题排查过程">问题排查过程</h2><p><code>onText</code> 和 <code>offText</code> 是相对参数，一模一样的代码逻辑。按理说，要么都可以正常传入，要么都不可以。为何偏偏 <code>onText</code> 不可以？</p><ul><li>第一步，新增一个 props 测试：以同样的方式添加一个新的 props <code>testText</code>，运行结果和 <code>offText</code> 一样正常。这就奇了怪了，咋 <code>onText</code> 就不行了呢？</li><li>第二步，再来试试看，把 <code>onText</code> 改成 <code>osText</code>，我去，竟然可以了 ！可以正常显示出来了！惊呆了宝宝。</li><li>这下再看 <code>onText</code> 和 <code>osText</code> 的区别，唯一的点就是 <code>on</code> 和  <code>os</code> 了，<code>on</code> 越看越眼熟，<code>JSX</code> 语法有 <code>onChange</code><code>onInput</code> 什么的，由此，应该是语法冲突，<code>onText</code> 被 <code>JSX</code> 识别成了 <code>on</code> 类语法。</li></ul><h2 id="解决方案">解决方案</h2><p>找到问题原因了，那怎么解决呢？</p><ul><li>最容易想到的一个方法就是改 props 名称，<code>onText</code> 改成 <code>openText</code> 一类的，可是如此一来，不仅组件 <code>switch</code> 要改，连使用到的项目也都要改。于组件库而言，特别是使用者众多的组件库而言，没有比突然的 API 接口变更 更让人心塞的了。那咋办呢？</li><li>加一个 <code>onText</code> 同类参数？使用 <code>onText || openText</code> 这种法子。当 <code>onText</code> 不存在时，取 <code>openText</code>。这样虽然能解决旧项目不用改变 API 使用的问题，但是增加了 API  复杂度，一个功能却使用两个参数实现，怎么都觉得不高级。</li><li>继续想，既然我能遇到这个问题，那肯定还有其他人也遇到吧？JSX 怎么处理的呢？Google 和 github 搜了一波，没结果。好吧，只能看看 JSX 的 Example 了（ <a href="https://github.com/vuejs/babel-plugin-transform-vue-jsx/blob/master/example/example.js">https://github.com/vuejs/babel-plugin-transform-vue-jsx/blob/master/example/example.js</a> ）。这一看关键了，JSX 有两种书写方式，既然当前书写方式不行，不能被正常识别。那就试试另一个看起来 80% 可行的方式，毕竟不用单独识别语法，直接一个参数囊括各种 API。一试，果然，<code>{...params}</code> 这种方式运行正常了！！！！</li></ul><p>由此，终极解决方案如下，换种 JSX 书写方式。</p><p>父组件：test.js</p><pre><code><span class="token keyword">import</span> DSwitch <span class="token keyword">from</span> <span class="token string">'./switch.js'</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  name<span class="token punctuation">:</span> <span class="token string">'Test'</span><span class="token punctuation">,</span>
  components<span class="token punctuation">:</span> <span class="token punctuation">{</span> DSwitch <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">render</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> params <span class="token operator">=</span> <span class="token punctuation">{</span>
      props<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        offText<span class="token punctuation">:</span> <span class="token string">"已关闭"</span><span class="token punctuation">,</span>
        onText<span class="token punctuation">:</span> <span class="token string">"已打开"</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>d<span class="token operator">-</span><span class="token keyword">switch</span> <span class="token punctuation">{</span><span class="token operator">...</span>params<span class="token punctuation">}</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>d<span class="token operator">-</span><span class="token keyword">switch</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><p>运行结果如下图，</p><p><img src="http://img.yaoyanhuo.com/jsx_on_syntax_right.png" alt="运行结果"></p><p>完美解决！无需改动任何组件库代码！</p></div></div></div></div><footer><a href="http://www.beian.miit.gov.cn" target="_blank">.沪ICP备19007658号. </a>&nbsp;
  <a href="http://www.yaoyanhuo.com">www.yaoyanhuo.com</a>  . Connect me by email yaoyanhuoyi@qq.com
</footer></div><script src="/js/chunk-vendors.feddb447.js"></script><script src="/js/app.1b00deba.js"></script></body></html>